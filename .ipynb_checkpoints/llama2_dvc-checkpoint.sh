#!/bin/bash
# =============================================================================
# Llama-2-7b-chat-hf 完整流程脚本
# =============================================================================
# 1. 使用 ModelScope 下载模型
# 2. 运行 DVC 流水线
# =============================================================================
set -e

# =============================================================================
# 配置参数 - 根据需要修改
# =============================================================================
MODEL_DIR="/share/home/tm902089733300000/a903202310/lys/models"
MODEL_NAME="Llama-2-7b-chat-hf"
MODEL_SCOPE_ID="shakechen/Llama-2-7b-chat-hf"

# =============================================================================
# Step 1: 下载模型
# =============================================================================
echo "=============================================="
echo "Step 1: 下载模型"
echo "=============================================="
echo "Model: $MODEL_SCOPE_ID"
echo "Target: $MODEL_DIR/$MODEL_NAME"
echo ""

# 检查模型是否已存在


echo ">>> 开始下载..."
modelscope download --model "$MODEL_SCOPE_ID" --local_dir "$MODEL_DIR/$MODEL_NAME"
echo "✓ 下载完成"

echo ""

# =============================================================================
# Step 2: 运行 DVC 流水线
# =============================================================================
echo "=============================================="
echo "Step 2: 运行 DVC 流水线"
echo "=============================================="
echo ""

# 确保在项目目录下
cd "$(dirname "$0")"

echo "当前目录: $(pwd)"
echo ""

# 运行 DVC
dvc repro

echo ""
echo "=============================================="
echo "完成！"
echo "=============================================="